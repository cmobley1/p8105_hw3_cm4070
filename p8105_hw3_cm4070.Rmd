---
title: "p8105_hw3_cm4070"
output: github_document
---

```{r loadlibraries_plots}
library(tidyverse)
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6, 
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options( 
  ggplot2.continuous.colour = "viridis", 
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Question 1

### Load data

```{r}
library(p8105.datasets)

data("instacart") 
```

There are `r nrow(instacart)` observations and `r ncol(instacart)` variables, and key variable names are `r names(instacart)` in the `instacart` data. 

### Describe aisles with plot

```{r}
instacart %>% 
  count(aisle, name = "n_columns") %>% 
  arrange(desc(n_columns)) %>% 
  filter(n_columns > 10000) %>% 
  mutate(aisle = forcats::fct_reorder(aisle, n_columns)) %>% 
  ggplot(aes(x = n_columns, y = aisle, color = aisle)) + geom_point() +
  labs(title = "Aisles' Popularity plot", 
    x = "number of items ordered in each aisle",
    y = "aisle name",
    caption = "Data from â€œThe Instacart Online Grocery Shopping Dataset 2017"
    ) +
    scale_x_continuous(
      limits = c(10000, 170000))
```

There are approximately 134 aisles. The aisles most ordered from are fresh vegetables, fresh fruits, and packaged vegetables and fruits. We can see this in the above plot where we see the number of items ordered in each aisle with its respective name and the values at approximately 150000 values are those most popular.

### Make a table with three most popular items within 3 aisles 

```{r}
popular_items =
  instacart %>%
  group_by(aisle, product_name) %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>%
  summarize(n_obs = n()) %>%
  arrange(desc(n_obs)) %>%
  slice(1:3) %>%
  knitr::kable(digits = 1)
popular_items
```

This table shows the top 3 most ordered products within baking ingredients, dog food care, and packaged vegetable fruits aisles, and number of times they were ordered.

### Mean hour table - Pink Lady Apples and Coffee Ice Cream

```{r}
instacart %>%
  select(product_name, order_dow, order_hour_of_day) %>%
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>%
  group_by(product_name, order_dow) %>%
  summarize(
    mean_hour_of_day = mean(order_hour_of_day)) %>%
  mutate(order_dow = 
           recode(order_dow,
                  "0" = "monday", "1" = "tuesday","2" = "wednesday", "3" = "thursday", "4" = "friday", "5" = "saturday","6" = "sunday")) %>%
    pivot_wider(
    names_from = order_dow,
    values_from = mean_hour_of_day) %>%
    knitr::kable(digits = 1)
```

This table shows the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are 
ordered  on each day of the week. 

## Question 2

### Clean the BRFSS Data set & build plots

```{r, warning= FALSE}
brfss = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic %in% "Overall Health" & response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% 
  mutate(response = forcats::fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))
  ) %>%
  filter(year == 2002) %>%
  separate(locationdesc, into = c("state", "county", convert = TRUE)) %>%
  group_by(state, county)  %>%
  distinct(county, .keep_all = TRUE)
```

```{r, warning= FALSE}
brfss2 = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic %in% "Overall Health" & response %in% c("Excellent", "Very good", "Good", "Fair", "Poor")) %>% 
  mutate(response = forcats::fct_relevel(response, c("Poor", "Fair", "Good", "Very good", "Excellent"))
  ) %>%
  filter(year == 2010) %>%
  separate(locationdesc, into = c("state", "county", convert = TRUE)) %>%
  group_by(state, county)  %>%
  distinct(county, .keep_all = TRUE)
```

It appears that 3 states in 2002 had more than 7 locations, and in 2010 about 10 had more than 7 locations.